---
title: "Analysis of Loan Grades"
output: html_document
bibliography: bibliographies.bib
vignette: >
    %\VignetteIndexEntry{Exploratory Analysis- Loan Amount} 
    %\VignetteEngine{knitr::rmarkdown}\usepackage[utf8]{inputenc} 
---

```{r, echo=F}
options(scipen = 6)
knitr::opts_chunk$set(cache=FALSE, fig.height=3, fig.width = 7, comment=NULL, eval=T, tidy=F, width=80, message= FALSE, echo= FALSE, warning = FALSE)
```

```{r, child="snippet/_preamble.Rmd"}
```


```{r, child="snippet/_nofilter.Rmd"}
```

## Loan Distribution by Grade


```{r, fig.align='right', fig.show='hold', fig.align='center'}
ggplot(LoanData) +
    aes(x= factor(grade)) +
    geom_histogram(stat="count") +
    labs(x= "Loan Grade") +
    theme_LC()

LoanData %>%
    group_by(grade) %>%
    summarize(Total= n()) %>%
    mutate(Proportion= Total/sum(Total)) %>%
    knitr::kable(align=c('l','r','r'),
                 digits=c(0,0,2),
                 caption= "Distribution by Loan Grade",
                 format.args = list(big.mark=','),
                 col.names = c("Grade","Total","Proportion"))
```

There are `r format(nrow(LoanData),big.mark=",")` loans in the dataset and the median loan grade level is `r LETTERS[median(as.numeric(factor(LoanData$grade)))]`. We can further describe this distribution using skewness and kurtosis.  From the table we can say intuitively that it is skewed towards the lower loan grades and tat the lower grade tail is fatter than the higher grade tail.  This is inherently true beacause the max grade is A and a tail with values greater than A cannot exist.  

Kurtosis is a description of the shape or peakedness of the curve. The kurtosis score for this distribution is `r e1071::kurtosis(as.numeric(factor(LoanData$grade)))`. For comparison, the normal distribution has a score of 3.0. We can interpret the comparison to say our issued loan distribution produces fewer and less extreme outliers than the normal distribution.  Again, this makes sense intuitively because there are only 7 possible grades.  This poses an upper and lower constraint on the loans effectively eliminating extreme outliers. 


```{r}
LoanData %>%
    mutate(Year= format(issue_d,"%Y")) %>%
    group_by(Year) %>%
    summarise(N=n()) %>%
    knitr::kable(format.args = list(big.mark=","),
                 align=c("l","r"),
                 col.names=c("Year","Count"))
```


LC was founded in 2007 so clearly they have not pulished data from their entire history.  The first 4 years of data have been excluded from the dataset. Of the published data, the number of loans issued has grown significantly since 2011.  In fact the first year growth rate was `r round(188181/42535,2)*100`%. Growth has leveled off since 2015 to only `r round(434407/421095,2)*100-100`%. The CAGR from 2011 to 2016 is `r round(CAGR(42535,434401,5),2)*100`%.

> QUESTION: Why has growth slowed in the past year?


```{r}
LoanData %>%
    mutate(Year= format(issue_d,"%Y")) %>%
    group_by(Year, grade) %>%
    summarize(N=n()) %>%
    mutate(share= round(N/sum(N),2)) %>%
    select(-N) %>%
    spread(key=Year, value=share) %>%
    knitr::kable(forate.args= list(big.mark=","),
                 caption= "Distribution by Loan Grade and Year",
                 align= c("l","r","r","r","r","r"))
```


### Package Version
The analysis was based on LendingClubData version `r packageVersion("LendingClubData")`.

### References